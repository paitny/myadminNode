import{h as M}from"./moment.9709ab41.js";import{_ as $,o as h,c as g,w as o,r as u,b as _,a as s,f as n}from"./index.32096110.js";const y={name:"ArticleManger",data(){return{musicData:[]}},methods:{dateFormat:function(e,a){let l=e[a.property];return l==null?"":M(l).format("YYYY-MM-DD HH:mm:ss")},async getMusic(){let{data:e}=await this.$axios({method:"get",url:"/get/music"});if(e.code)return this.$message.error(e.msg);this.musicData=e.data},async update(e,a){let{data:l}=await this.$axios({method:"POST",url:"/adminServer/music/update",data:{id:e,doc:a}});if(l.code)return this.$message.error(l.msg);this.$message.success("\u66F4\u65B0\u6210\u529F"),await this.getMusic()},music_before_upload(e){let a=/\.(mp3|m4a)$/.test(e.name);return a||this.$message.error("\u8BF7\u4E0A\u4F20\u97F3\u4E50\u6587\u4EF6"),a},music_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{url:e.url})},cover_before_upload(e){const a=/^image\/(jpeg|png)$/.test(e.type),l=e.size/1024/1024<2;return a||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u53EA\u80FD\u662F JPG/PNG \u683C\u5F0F!"),l||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 2MB!"),a&&l},cover_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{cover:e.url})},async deleteMusic(e){let{data:a}=await this.$axios({method:"DELETE",url:"/adminServer/music/delete",data:{id:e}});if(a.code)return this.$message.error(a.msg);this.$message.success("\u5220\u9664\u5B8C\u6210"),await this.getMusic()}},created(){this.getMusic()}},V={id:"ArticleManger"},x=n("\u70B9\u51FB\u66F4\u65B0\u97F3\u4E50\u6587\u4EF6"),U={class:"cover"},k=n("\u91CD\u4F20\u5C01\u9762"),D={class:"buttonSubmit"},C=n("\u4FEE\u6539 "),S=n("\u5220\u9664 ");function z(e,a,l,L,p,i){const d=u("el-table-column"),m=u("el-input"),c=u("el-button"),f=u("el-upload"),w=u("el-image"),b=u("el-table"),v=u("el-card");return h(),g(v,null,{default:o(()=>[_("div",V,[s(b,{data:p.musicData,border:"",style:{width:"100%"}},{default:o(()=>[(h(),g(d,{prop:"date",label:"\u53D1\u5E03\u65E5\u671F",key:p.musicData.date,formatter:i.dateFormat,align:"center"},null,8,["formatter"])),s(d,{label:"\u6B4C\u540D"},{default:o(t=>[s(m,{modelValue:t.row.name,"onUpdate:modelValue":r=>t.row.name=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(d,{label:"\u6F14\u5531\u8005"},{default:o(t=>[s(m,{modelValue:t.row.artist,"onUpdate:modelValue":r=>t.row.artist=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(d,{label:"\u4E3B\u9898\u989C\u8272"},{default:o(t=>[s(m,{modelValue:t.row.theme,"onUpdate:modelValue":r=>t.row.theme=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(d,{label:"\u91CD\u65B0\u4E0A\u4F20\u97F3\u4E50\u6587\u4EF6"},{default:o(t=>[s(f,{class:"upload-demo",action:`${e.baseURL}/adminServer/music/musicAdd`,"on-success":function(r){i.music_upload_success(r,t.row._id)},"before-upload":i.music_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:o(()=>[s(c,{size:"large",type:"success"},{default:o(()=>[x]),_:1})]),_:2},1032,["action","on-success","before-upload"])]),_:1}),s(d,{label:"\u91CD\u65B0\u4E0A\u4F20\u5C01\u9762\u56FE"},{default:o(t=>[_("div",U,[s(w,{style:{width:"200px",height:"150px"},src:`${e.baseURL}${t.row.cover}`,"preview-src-list":[`${e.baseURL}${t.row.cover}`],"preview-teleported":"true",previewTeleported:""},null,8,["src","preview-src-list"]),s(f,{class:"upload-demo",action:"/adminServer/music/cover","on-success":function(r){i.cover_upload_success(r,t.row._id)},"before-upload":i.cover_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:o(()=>[s(c,{size:"large",type:"warning",style:{margin:"auto 0"}},{default:o(()=>[k]),_:1})]),_:2},1032,["on-success","before-upload"])])]),_:1}),s(d,{fixed:"right",label:"\u64CD\u4F5C"},{default:o(t=>[_("div",D,[s(c,{type:"primary",onClick:r=>i.update(t.row._id,{name:t.row.name,artist:t.row.artist,theme:t.row.theme}),size:"large"},{default:o(()=>[C]),_:2},1032,["onClick"]),s(c,{type:"danger",onClick:r=>i.deleteMusic(t.row._id),size:"large"},{default:o(()=>[S]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),_:1})}const P=$(y,[["render",z],["__scopeId","data-v-8a3edc5e"]]);export{P as default};
