import{h as V}from"./moment.9709ab41.js";import{_ as U,o as g,d as w,w as l,r as i,b as _,e as a,h as f}from"./index.f66fb179.js";const x={name:"ArticleManger",data(){return{musicData:[]}},methods:{dateFormat:function(e,t){let o=e[t.property];return o==null?"":V(o).format("YYYY-MM-DD HH:mm:ss")},async getMusic(){let{data:e}=await this.$axios({method:"get",url:"/get/music"});if(e.code)return this.$message.error(e.msg);this.musicData=e.data},async lrcupdate(e,t){let{data:o}=await this.$axios({method:"POST",url:"/adminServer/music/lrcupdate",data:{id:e,doc:t}});if(o.code)return this.$message.error(o.msg);this.$message.success("\u66F4\u65B0\u6210\u529F"),await this.getMusic()},lrc_before_upload(e){let t=/\.lrc$/.test(e.name);return t||this.$message.error("\u53EA\u80FD\u4E0A\u4F20.lrc\u6587\u4EF6"),t},lrc_upload_success(e,t){if(e.code)return this.$message.error(e.msg);this.lrcupdate(t,{lrc:e.url})},async update(e,t){let{data:o}=await this.$axios({method:"POST",url:"/adminServer/music/update",data:{id:e,doc:t}});if(o.code)return this.$message.error(o.msg);this.$message.success("\u66F4\u65B0\u6210\u529F"),await this.getMusic()},music_before_upload(e){let t=/\.(mp3|m4a)$/.test(e.name);return t||this.$message.error("\u8BF7\u4E0A\u4F20\u97F3\u4E50\u6587\u4EF6"),t},music_upload_success(e,t){if(e.code)return this.$message.error(e.msg);this.update(t,{url:e.url})},cover_before_upload(e){const t=/^image\/(jpeg|png)$/.test(e.type),o=e.size/1024/1024<2;return t||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u53EA\u80FD\u662F JPG/PNG \u683C\u5F0F!"),o||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 2MB!"),t&&o},cover_upload_success(e,t){if(e.code)return this.$message.error(e.msg);this.update(t,{cover:e.url})},async deleteMusic(e){let{data:t}=await this.$axios({method:"DELETE",url:"/adminServer/music/delete",data:{id:e}});if(t.code)return this.$message.error(t.msg);this.$message.success("\u5220\u9664\u5B8C\u6210"),await this.getMusic()}},created(){this.getMusic()}},D={id:"ArticleManger"},S=f("\u66F4\u65B0\u97F3\u4E50"),k=f("\u66F4\u65B0\u6B4C\u8BCD"),C={class:"cover"},L=f("\u91CD\u4F20\u5C01\u9762"),E={class:"buttonSubmit"};function P(e,t,o,T,p,c){const u=i("el-table-column"),n=i("el-input"),d=i("el-button"),m=i("el-upload"),b=i("el-image"),v=i("Edit"),h=i("el-icon"),$=i("Delete"),M=i("el-table"),y=i("el-card");return g(),w(y,null,{default:l(()=>[_("div",D,[a(M,{data:p.musicData,border:"",style:{width:"100%"}},{default:l(()=>[(g(),w(u,{prop:"date",label:"\u53D1\u5E03\u65E5\u671F",key:p.musicData.date,formatter:c.dateFormat,align:"center"},null,8,["formatter"])),a(u,{label:"\u6B4C\u540D",align:"center"},{default:l(s=>[a(n,{modelValue:s.row.name,"onUpdate:modelValue":r=>s.row.name=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{label:"\u6F14\u5531\u8005",align:"center"},{default:l(s=>[a(n,{modelValue:s.row.artist,"onUpdate:modelValue":r=>s.row.artist=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{label:"\u4E3B\u9898\u989C\u8272",align:"center"},{default:l(s=>[a(n,{modelValue:s.row.theme,"onUpdate:modelValue":r=>s.row.theme=r},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{label:"\u66F4\u65B0\u97F3\u4E50",align:"center"},{default:l(s=>[a(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/music/musicAdd`,"on-success":function(r){c.music_upload_success(r,s.row._id)},"before-upload":c.music_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:l(()=>[a(d,{size:"large",type:"success"},{default:l(()=>[S]),_:1})]),_:2},1032,["action","on-success","before-upload"])]),_:1}),a(u,{label:"\u66F4\u65B0\u6B4C\u8BCD",align:"center"},{default:l(s=>[a(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/music/lrc`,"on-success":function(r){c.lrc_upload_success(r,s.row._id)},"before-upload":c.lrc_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:l(()=>[a(d,{size:"large",type:"success"},{default:l(()=>[k]),_:1})]),_:2},1032,["action","on-success","before-upload"])]),_:1}),a(u,{label:"\u91CD\u65B0\u4E0A\u4F20\u5C01\u9762\u56FE",align:"center",width:"350px"},{default:l(s=>[_("div",C,[a(b,{style:{width:"200px",height:"150px"},src:`${e.baseURL}${s.row.cover}`,"preview-src-list":[`${e.baseURL}${s.row.cover}`],"preview-teleported":"true",previewTeleported:""},null,8,["src","preview-src-list"]),a(m,{class:"upload-demo",action:"/adminServer/music/cover","on-success":function(r){c.cover_upload_success(r,s.row._id)},"before-upload":c.cover_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:l(()=>[a(d,{size:"large",type:"warning",style:{margin:"auto 0"}},{default:l(()=>[L]),_:1})]),_:2},1032,["on-success","before-upload"])])]),_:1}),a(u,{label:"\u64CD\u4F5C",align:"center"},{default:l(s=>[_("div",E,[a(d,{type:"primary",onClick:r=>c.update(s.row._id,{name:s.row.name,artist:s.row.artist,theme:s.row.theme})},{default:l(()=>[a(h,null,{default:l(()=>[a(v)]),_:1})]),_:2},1032,["onClick"]),a(d,{type:"danger",onClick:r=>c.deleteMusic(s.row._id),circle:""},{default:l(()=>[a(h,null,{default:l(()=>[a($)]),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),_:1})}const N=U(x,[["render",P],["__scopeId","data-v-dfb6047d"]]);export{N as default};
